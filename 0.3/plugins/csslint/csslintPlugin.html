<!DOCTYPE html> 
<html> 
<head> 
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> 
	<script src="http://orionhub.org/orion/plugin.js"></script> 
	<script src="http://csslint.net/js/csslint.js"></script> 
	<script src="lib/css-outline.js"></script>
	<script> 
/*******************************************************************************
 * Copyright (c) 2010, 2011 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials are made 
 * available under the terms of the Eclipse Public License v1.0 
 * (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 * License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 
 *
 * Contributors:
 *     IBM Corporation - initial API and implementation
 *******************************************************************************/
		window.onload = function() {
			var csslintService = {
					checkSyntax : function(title, contents) {
						var cssResult = CSSLint.verify(contents),
						    messages = cssResult.messages,
						    lines = contents.split(/\r?\n/),
						    problems = [];
						for (var i=0; i < messages.length; i++) {
							var message = messages[i];
							if (message.line) {
								var lineText = lines[message.line - 1];
								var problem = {
									description: message.message,
									line: message.line,
									start: message.col,
									end: lineText.indexOf(message.evidence) + message.evidence.length,
									severity: message.type
								};
								// problem.tooltip = problem.rule.desc;
								// function property will cause serviceregistry error
								problems.push(problem);
							}
						}
						return {problems: problems};
					}
			};
			try {
				var provider = new eclipse.PluginProvider();
				var serviceProvider = provider.registerServiceProvider("orion.edit.validator", csslintService, {
					pattern: "\\.css$"
				});
				provider.registerServiceProvider("orion.edit.outliner",
					{
						// TODO outlines should be pushed, not pulled, so we can avoid parsing twice
						getOutline: function(contents, title) {
							CSSLint.verify(contents);
							return window.cssOutline;
						}
					}, {
						pattern: "\\.css$",
						id: "orion.outline.css.csslint",
						name: "CSS rule outline"
					});
				provider.connect();
			} finally {
				if (document && document.getElementById) {
					document.getElementById("url").appendChild(document.createTextNode(window.location));
				}
			}
		};
	</script>
	<title>CSSLint Plugin</title>
</head>
<body><h1>CSSLint plugin for Orion</h1>
<p>This is a plugin for <a href="http://wiki.eclipse.org/Orion/">Orion</a>. It is not meant to be viewed in a browser.</p>
<p>To install this plugin, follow <a href="http://wiki.eclipse.org/Orion/How_Tos/Installing_A_Plugin">these instructions</a> using this URL:</p>
<p id="url" style="font-family: monospace; font-size: large; padding-left:2em;"></p>
<p><em>Requires Orion 0.3</em></p>
</body> 
</html>